<!-- This file contains ONLY the content for the "Memory Management" lesson. -->
<div class="max-w-4xl mx-auto bg-white p-8 rounded-lg shadow-lg">
    <div class="mb-8">
        <div class="flex items-center justify-between mb-6">
            <h1 class="text-4xl font-extrabold text-gray-900">49. Memory Management</h1>
            <span
                class="bg-blue-100 text-blue-800 text-sm font-medium px-3 py-1 rounded-full whitespace-nowrap">Advanced
                Level</span>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-3 mb-6">
            <!-- Progress bar: (49-39)/18 = 55.6% for advanced (lessons 40-57) -->
            <div class="bg-gradient-to-r from-indigo-500 to-purple-500 h-3 rounded-full transition-all duration-300"
                style="width: 55.6%"></div>
        </div>
    </div>

    <section class="mb-8">
        <div class="relative mb-8">
            <div class="absolute -top-6 left-6 z-10">
                <span
                    class="inline-flex items-center justify-center w-14 h-14 bg-blue-100 bg-opacity-80 backdrop-blur-md border-4 border-blue-300 shadow-lg rounded-full text-3xl text-blue-600 transition-transform duration-200 hover:scale-110 animate-fade-in">🧠</span>
            </div>
            <div
                class="bg-gradient-to-br from-blue-50/80 to-white/80 backdrop-blur-md border-2 border-blue-200 shadow-xl rounded-2xl p-8 pt-12 animate-fade-in">
                <h2 class="text-3xl font-extrabold mb-4 text-blue-800 tracking-tight">Why Memory Management Matters</h2>
                <p class="text-lg leading-relaxed mb-4">
                    <strong class="text-blue-600">Memory management</strong> is how Python allocates, uses, and frees up
                    memory while your program runs. Understanding memory management helps you write efficient, robust
                    code and avoid common pitfalls like memory leaks and excessive memory usage.
                </p>
                <p class="text-lg leading-relaxed mb-4">
                    Python automates most memory management with its <strong>garbage collector</strong>, but advanced
                    developers need to know how objects are stored, referenced, and cleaned up—especially for large
                    data, long-running processes, or performance-critical applications.
                </p>
                <p class="text-lg leading-relaxed mb-4">
                    <strong>Real-world scenarios:</strong>
                <ul class="list-disc list-inside ml-6 mt-2 text-lg leading-relaxed">
                    <li>Analyzing memory usage in data science scripts</li>
                    <li>Preventing memory leaks in web servers or background jobs</li>
                    <li>Optimizing code for embedded or resource-constrained environments</li>
                    <li>Debugging crashes due to excessive memory consumption</li>
                </ul>
                </p>
                <p class="text-lg leading-relaxed">
                    Python's memory model is powerful, but understanding its details can help you write more
                    professional code.
                </p>
            </div>
        </div>
    </section>

    <section class="mb-8">
        <div class="relative mb-8">
            <div class="absolute -top-6 left-6 z-10">
                <span
                    class="inline-flex items-center justify-center w-14 h-14 bg-blue-100 bg-opacity-80 backdrop-blur-md border-4 border-blue-300 shadow-lg rounded-full text-3xl text-blue-600 transition-transform duration-200 hover:scale-110 animate-fade-in">💡</span>
            </div>
            <div
                class="bg-gradient-to-br from-blue-50/80 to-white/80 backdrop-blur-md border-2 border-blue-200 shadow-xl rounded-2xl p-8 pt-12 animate-fade-in">
                <h2 class="text-3xl font-extrabold mb-4 text-blue-800 tracking-tight">Key Concepts: Python Memory Model
                </h2>
                <ul
                    class="list-disc list-inside ml-4 mt-2 text-lg leading-relaxed space-y-2 bg-white/90 border-l-4 border-blue-300 shadow-md rounded-xl p-6 animate-fade-in">
                    <li><strong class="text-blue-600">Reference Counting:</strong> Python keeps track of how many
                        references point to each object. When the count drops to zero, the object is deleted.</li>
                    <li><strong class="text-blue-600">Garbage Collection:</strong> Python's <code>gc</code> module
                        automatically finds and cleans up objects that are no longer needed, even if they are part of
                        reference cycles.</li>
                    <li><strong class="text-blue-600">Memory Leaks:</strong> Occur when objects are unintentionally kept
                        alive, causing memory usage to grow over time.</li>
                    <li><strong class="text-blue-600">The <code>del</code> Statement:</strong> Removes a reference to an
                        object, potentially freeing memory sooner.</li>
                    <li><strong class="text-blue-600">The <code>sys.getsizeof()</code> Function:</strong> Returns the
                        size of an object in bytes.</li>
                </ul>
                <div class="mt-6">
                    <h3 class="text-xl font-semibold text-blue-800 mb-2">Example: Reference Counting & Garbage
                        Collection</h3>
                    <div class="code-editor-example mb-6 rounded-2xl">
                        <div class="code-editor-bar">
                            <div class="code-editor-dots flex gap-1">
                                <div class="code-editor-dot-red"></div>
                                <div class="code-editor-dot-yellow"></div>
                                <div class="code-editor-dot-green"></div>
                            </div>
                        </div>
                        <span class="text-gray-400 text-xs">memory_example.py</span>
                        <pre><code><span style="color: #6272a4;">import</span> <span style="color: #8be9fd;">sys</span>
<span style="color: #6272a4;">import</span> <span style="color: #8be9fd;">gc</span>

<span style="color: #8be9fd;">a</span> <span style="color: #ff79c6;">=</span> [<span style="color: #bd93f9;">1</span>, <span style="color: #bd93f9;">2</span>, <span style="color: #bd93f9;">3</span>]
<span style="color: #8be9fd;">b</span> <span style="color: #ff79c6;">=</span> <span style="color: #8be9fd;">a</span>
<span style="color: #50fa7b;">print</span>(<span style="color: #f1fa8c;">sys.getrefcount</span>(<span style="color: #8be9fd;">a</span>))  <span style="color: #6272a4;"># Reference count for a</span>
<span style="color: #50fa7b;">del</span> <span style="color: #8be9fd;">b</span>
<span style="color: #50fa7b;">print</span>(<span style="color: #f1fa8c;">sys.getrefcount</span>(<span style="color: #8be9fd;">a</span>))  <span style="color: #6272a4;"># Reference count after deleting b</span>

<span style="color: #50fa7b;">print</span>(<span style="color: #f1fa8c;">sys.getsizeof</span>(<span style="color: #8be9fd;">a</span>), <span style="color: #f1fa8c;">"bytes"</span>)  <span style="color: #6272a4;"># Size of the list in bytes</span>

<span style="color: #50fa7b;">gc.collect</span>()  <span style="color: #6272a4;"># Force garbage collection</span>
</code></pre>
                    </div>
                    <div class="bg-gray-900 p-4 rounded-2xl mt-4">
                        <h3 class="text-white font-semibold mb-3">💡 Expected Output:</h3>
                        <pre class="text-green-400 text-sm"><code>3
2
80 bytes
</code></pre>
                    </div>
                </div>
                <div class="mt-6">
                    <h3 class="text-xl font-semibold text-blue-800 mb-2">Example: Memory Leak (Reference Cycle)</h3>
                    <div class="code-editor-example mb-6 rounded-2xl">
                        <div class="code-editor-bar">
                            <div class="code-editor-dots flex gap-1">
                                <div class="code-editor-dot-red"></div>
                                <div class="code-editor-dot-yellow"></div>
                                <div class="code-editor-dot-green"></div>
                            </div>
                        </div>
                        <span class="text-gray-400 text-xs">leak_example.py</span>
                        <pre><code><span style="color: #6272a4;">class</span> <span style="color: #50fa7b;">Node</span>:
    <span style="color: #6272a4;">def</span> <span style="color: #50fa7b;">__init__</span>(<span style="color: #f8f8f2;">self</span>):
        <span style="color: #f8f8f2;">self</span>.<span style="color: #f8f8f2;">ref</span> <span style="color: #ff79c6;">=</span> <span style="color: #f1fa8c;">None</span>

<span style="color: #f8f8f2;">a</span> <span style="color: #ff79c6;">=</span> <span style="color: #50fa7b;">Node</span>()
<span style="color: #f8f8f2;">b</span> <span style="color: #ff79c6;">=</span> <span style="color: #50fa7b;">Node</span>()
<span style="color: #f8f8f2;">a</span>.<span style="color: #f8f8f2;">ref</span> <span style="color: #ff79c6;">=</span> <span style="color: #f8f8f2;">b</span>
<span style="color: #f8f8f2;">b</span>.<span style="color: #f8f8f2;">ref</span> <span style="color: #ff79c6;">=</span> <span style="color: #f8f8f2;">a</span>  <span style="color: #6272a4;"># Reference cycle</span>

<span style="color: #50fa7b;">del</span> <span style="color: #f8f8f2;">a</span>
<span style="color: #50fa7b;">del</span> <span style="color: #f8f8f2;">b</span>

<span style="color: #6272a4;"># Objects may not be immediately freed due to the cycle</span>
<span style="color: #6272a4;">import</span> <span style="color: #f8f8f2;">gc</span>
<span style="color: #50fa7b;">print</span>(<span style="color: #f1fa8c;">gc.collect</span>())  <span style="color: #6272a4;"># Force collection, returns number of unreachable objects</span>
</code></pre>
                    </div>
                    <div class="bg-gray-900 p-4 rounded-2xl mt-4">
                        <h3 class="text-white font-semibold mb-3">💡 Expected Output:</h3>
                        <pre class="text-green-400 text-sm"><code>0
</code></pre>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="mb-8">
        <h2 class="text-2xl font-semibold mb-4 text-green-700 flex items-center">
            <span class="bg-green-100 text-green-600 p-2 rounded-lg mr-3">🧪</span>
            Try it Yourself
        </h2>
        <div class="bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-xl p-6 shadow-sm mb-6">
            <p class="text-lg leading-relaxed mb-4">
                Write a function that creates a large list (e.g., 1 million numbers), prints its size in bytes, and then
                deletes it. Observe how memory usage changes.
            </p>
        </div>
        <!-- Code Editor Area -->
        <div id="code-editor-container" class="bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200"></div>
        <script type="text/plain" id="default-code">
import sys

big_list = list(range(1000000))
print("Size in bytes:", sys.getsizeof(big_list))
del big_list
# Try printing again or using gc.collect()
        </script>
    </section>

    <!-- Challenge Section -->
    <section class="mb-8">
        <h2 class="text-2xl font-semibold mb-4 text-purple-700 flex items-center">
            <span class="bg-purple-100 text-purple-600 p-2 rounded-lg mr-3">🏆</span>
            Project Challenge: Analyze & Optimize Memory Usage
        </h2>
        <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-lg border-l-4 border-purple-500">
            <p class="text-lg leading-relaxed mb-4">
                <strong>Real-World Project:</strong> Analyze the memory usage of a Python script that processes a large
                dataset (e.g., reading a big file, manipulating data in memory). Identify memory bottlenecks and
                refactor the code to use less memory (e.g., with generators, in-place operations, or data structure
                changes).
            </p>
            <ul class="list-decimal list-inside ml-4 mt-2 text-lg leading-relaxed space-y-2">
                <li>Profile the script's memory usage (e.g., with <code>sys.getsizeof()</code> or
                    <code>memory_profiler</code>).
                </li>
                <li>Identify where most memory is used.</li>
                <li>Refactor the code to reduce memory usage (e.g., use generators instead of lists).</li>
                <li>Show before/after memory usage and explain your changes.</li>
                <li>Bonus: Automate memory profiling in your test suite or CI/CD pipeline.</li>
            </ul>
            <div class="bg-gray-900 p-4 rounded-lg mt-6">
                <h3 class="text-white font-semibold mb-3">💡 Project Example Output:</h3>
                <pre class="text-green-400 text-sm"><code># Before: Used 500MB RAM
# After: Uses 50MB RAM with generators
</code></pre>
            </div>
            <p class="text-md text-gray-600 mt-4">This project will challenge you to think like a performance engineer
                and write memory-efficient Python code.</p>
        </div>
    </section>

    <!-- Navigation Buttons -->
    <div class="flex justify-between items-center mt-8 pt-6 border-t border-gray-200">
        <a href="#" onclick="loadLesson('lessons/design_patterns.html')"
            class="flex items-center px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors duration-200">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
            Previous: Design Patterns
        </a>
        <div class="text-gray-600">
            <span class="text-sm">Lesson 49 of 71</span>
        </div>
        <a href="#" onclick="loadLesson('lessons/multithreading.html')"
            class="flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200">
            Next: Multithreading
            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
        </a>
    </div>
</div>